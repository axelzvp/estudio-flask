<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiStudy - Panel de Maestro</title>
    
    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\$$', '\$$']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSS Propio -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/maestro.css') }}">

    
    
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-chalkboard-teacher"></i>
            </div>
            <div class="logo-text">
                <h1>MultiStudy</h1>
                <p id="userGreeting">Panel de Maestro</p>
            </div>
        </div>
        
        <nav class="menu">
            <div class="menu-item active" data-page="questions">
                <i class="fas fa-list"></i>
                <span>Banco de Preguntas</span>
            </div>
            <div class="menu-item" data-page="stats">
                <i class="fas fa-chart-bar"></i>
                <span>Estad√≠sticas</span>
            </div>
            <div class="menu-item" data-page="study">
                <i class="fas fa-book-open"></i>
                <span>Modo Estudio</span>
            </div>
            <div class="menu-item" data-page="simulators">
                <i class="fas fa-clipboard-check"></i>
                <span>Simuladores</span>
            </div>
            <div class="menu-item" id="openModalBtn">
                <i class="fas fa-plus-circle"></i>
                <span>Nueva Pregunta</span>
            </div>
        </nav>
        
        <div class="stats-sidebar">
            <div class="stats-header">
                <i class="fas fa-chart-pie"></i>
                <span>Resumen</span>
            </div>
            <div class="stat-mini">
                <div class="stat-icon"><i class="fas fa-question-circle"></i></div>
                <div class="stat-info">
                    <span class="stat-value" id="sidebarTotal">0</span>
                    <span class="stat-label">Preguntas</span>
                </div>
            </div>
            <div class="stat-mini">
                <div class="stat-icon"><i class="fas fa-book"></i></div>
                <div class="stat-info">
                    <span class="stat-value" id="sidebarSubjects">0</span>
                    <span class="stat-label">Materias</span>
                </div>
            </div>
            <div class="stat-mini">
                <div class="stat-icon"><i class="fas fa-eye"></i></div>
                <div class="stat-info">
                    <span class="stat-value" id="sidebarShown">0</span>
                    <span class="stat-label">Estudiadas</span>
                </div>
            </div>
        </div>
        
        <div class="user-profile">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <div class="user-details">
                    <span class="user-name" id="userName"></span>
                    <span class="user-role" id="userRole">üë®‚Äçüè´ Maestro</span>
                </div>
                <button class="btn-logout" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- P√°gina: Banco de Preguntas -->
        <div class="page active" id="questionsPage">
            <div class="page-header">
                <div class="page-header-content">
                    <h2 class="page-title">
                        <i class="fas fa-list"></i> 
                        Banco de Preguntas
                    </h2>
                    <p class="page-subtitle">Administra todas las preguntas del sistema</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-ghost" id="showHelpBtn">
                        <i class="fas fa-question-circle"></i>
                    </button>
                    <button class="btn btn-primary" id="openModalFromListBtn">
                        <i class="fas fa-plus"></i>
                        Nueva Pregunta
                    </button>
                    <!-- En el page-header de la p√°gina de preguntas, a√±ade esto junto a los otros botones -->
                    <button class="btn btn-success" onclick="openBulkModal()" style="margin-left: 10px;">
                        <i class="fas fa-file-import"></i>
                        Carga Masiva
                    </button>
                </div>
            </div>
            
            <!-- Resumen estad√≠stico -->
            <div class="stats-summary">
                <div class="stat-box">
                    <div class="number" id="totalQuestionsStat">0</div>
                    <div class="label">Total de Preguntas</div>
                </div>
                <div class="stat-box">
                    <div class="number" id="totalSubjectsStat">0</div>
                    <div class="label">Materias Diferentes</div>
                </div>
                <div class="stat-box">
                    <div class="number" id="totalShownStat">0</div>
                    <div class="label">Veces Estudiadas</div>
                </div>
                <div class="stat-box">
                    <div class="number" id="totalCorrectStat">0</div>
                    <div class="label">Respuestas Correctas</div>
                </div>
            </div>
            
            <!-- Filtros y b√∫squeda -->
            <div class="filter-container">
                <select class="filter-select" id="subjectFilter">
                    <option value="todos">Todas las materias</option>
                </select>
                
                <select class="filter-select" id="topicFilter">
                    <option value="todos">Todos los temas</option>
                </select>
                
                <select class="filter-select" id="universityFilter">
                    <option value="todos">Todas las universidades</option>
                    <option value="UNAM">UNAM</option>
                    <option value="IPN">IPN</option>
                    <option value="UAM">UAM</option>
                    <option value="TEC">TEC</option>
                    <option value="EXANI">EXANI</option>
                </select>
                
                <select class="filter-select" id="typeFilter">
                    <option value="todos">Todos los tipos</option>
                    <option value="opciones">Opciones m√∫ltiples</option>
                    <option value="abierta">Respuesta abierta</option>
                </select>
                
                <button class="btn btn-outline btn-sm" id="clearFiltersBtn">
                    <i class="fas fa-times"></i> Limpiar
                </button>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" 
                       placeholder="Buscar en preguntas y respuestas...">
                <button class="btn btn-primary" id="searchBtn">
                    <i class="fas fa-search"></i> Buscar
                </button>
            </div>
            
            <!-- Lista de preguntas -->
            <div class="questions-grid" id="questionsList">
                <!-- Las preguntas se cargan din√°micamente -->
            </div>
            
            <!-- Estado vac√≠o -->
            <div id="noQuestionsMessage" class="empty-state" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-inbox"></i>
                </div>
                <h3>No hay preguntas todav√≠a</h3>
                <p>Comienza agregando tu primera pregunta</p>
                <button class="btn btn-primary" id="addFirstQuestionBtn">
                    <i class="fas fa-plus"></i>
                    Agregar Primera Pregunta
                </button>
            </div>
            
            <!-- Sin resultados de b√∫squeda -->
            <div id="noSearchResults" class="empty-state" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-search"></i>
                </div>
                <h3>Sin resultados</h3>
                <p>No hay preguntas que coincidan con tu b√∫squeda</p>
                <button class="btn btn-outline" id="clearSearchBtn">
                    <i class="fas fa-times"></i> Limpiar B√∫squeda
                </button>
            </div>
            
            <!-- Paginaci√≥n -->
            <div class="pagination" id="pagination" style="display: none;">
                <button class="page-btn" id="prevPageBtn" disabled>
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span id="pageInfo" style="color: var(--text-muted); font-size: 0.9rem;">
                    P√°gina 1 de 1
                </span>
                <button class="page-btn" id="nextPageBtn" disabled>
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
        
        <!-- P√°gina: Estad√≠sticas -->
        <div class="page" id="statsPage">
            <div class="page-header">
                <div class="page-header-content">
                    <h2 class="page-title">
                        <i class="fas fa-chart-bar"></i> 
                        Estad√≠sticas Detalladas
                    </h2>
                    <p class="page-subtitle">An√°lisis completo del sistema</p>
                </div>
            </div>
            
            <!-- Gr√°ficos principales -->
            <div class="stats-grid">
                <div class="stats-card">
                    <div class="stats-card-header">
                        <i class="fas fa-chart-pie"></i>
                        <span>Distribuci√≥n por Materias</span>
                    </div>
                    <div class="stats-card-body">
                        <div id="subjectsChart"></div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-card-header">
                        <i class="fas fa-university"></i>
                        <span>Distribuci√≥n por Universidad</span>
                    </div>
                    <div class="stats-card-body">
                        <div id="universitiesChart"></div>
                    </div>
                </div>
            </div>
            
            <!-- Estad√≠sticas detalladas -->
            <div class="stats-grid" style="margin-top: 20px;">
                <div class="stats-card">
                    <div class="stats-card-header">
                        <i class="fas fa-star"></i>
                        <span>Temas m√°s Populares</span>
                    </div>
                    <div class="stats-card-body">
                        <div id="topTopicsList"></div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="stats-card-header">
                        <i class="fas fa-check-circle"></i>
                        <span>Rendimiento</span>
                    </div>
                    <div class="stats-card-body">
                        <div id="performanceStats"></div>
                    </div>
                </div>
            </div>
            
            <!-- Tabla de preguntas m√°s vistas -->
            <div class="stats-card" style="margin-top: 20px;">
                <div class="stats-card-header">
                    <i class="fas fa-eye"></i>
                    <span>Preguntas M√°s Visitadas</span>
                </div>
                <div class="stats-card-body">
                    <div id="mostViewedQuestions">
                        <!-- Se carga din√°micamente -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- P√°gina: Simuladores -->
        <div class="page" id="simulatorsPage">
            <div class="page-header">
                <div class="page-header-content">
                    <h2 class="page-title">
                        <i class="fas fa-clipboard-check"></i> 
                        Simuladores
                    </h2>
                    <p class="page-subtitle">Configura el tiempo fijo de cada simulador</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline btn-sm" id="refreshSimulatorsBtn">
                        <i class="fas fa-sync"></i> Recargar
                    </button>
                </div>
            </div>
            
            <div class="simulators-admin">
                <div class="simulator-create">
                    <h3><i class="fas fa-plus-circle"></i> Nuevo simulador</h3>
                    <div class="form-row" style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <input type="text" class="form-control" id="newSimulatorName" placeholder="Nombre del simulador">
                        <input type="number" class="form-control" id="newSimulatorTime" placeholder="Tiempo (min)" min="1" value="30">
                        <button class="btn btn-primary" id="createSimulatorBtn">
                            <i class="fas fa-save"></i> Guardar
                        </button>
                    </div>
                    <div class="form-hint">
                        <i class="fas fa-info-circle"></i> El tiempo es fijo y no lo puede cambiar el alumno.
                    </div>
                </div>
                
                <div class="simulator-list" id="simulatorListAdmin">
                    <!-- Simuladores se cargan din√°micamente -->
                </div>
            </div>
        </div>

        <!-- P√°gina: Modo Estudio (para que el maestro tambi√©n pueda estudiar) -->
        <div class="page" id="studyPage">
            <div class="page-header">
                <div class="page-header-content">
                    <h2 class="page-title">
                        <i class="fas fa-book-open"></i> 
                        Modo Estudio
                    </h2>
                    <p class="page-subtitle">Prueba las preguntas como lo har√≠a un alumno</p>
                </div>
            </div>
            
            <!-- Selector de materias -->
            <div class="study-selector" id="subjectSelectorContainer">
                <div class="study-selector-header">
                    <div class="section-title">
                        <i class="fas fa-th-large"></i>
                        <span>Selecciona una materia</span>
                    </div>
                </div>
                
                <div class="study-selector-body">
                    <div class="subjects-grid" id="subjectButtons">
                        <!-- Las materias se cargan dinamicamente -->
                    </div>
                    
                    <!-- Temas -->
                    <div id="topicSelectorContainer" class="topics-section" style="display: none;">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-folder-open"></i>
                                <span>Temas de <strong id="currentSubjectName"></strong></span>
                            </div>
                        </div>
                        <div class="topics-chips" id="studyTopicButtons">
                            <!-- Los temas se cargan aqui -->
                        </div>
                    </div>
                    
                    <!-- Boton para comenzar -->
                    <div class="study-action">
                        <button class="btn btn-primary btn-lg" id="getQuestionBtn">
                            <i class="fas fa-dice"></i>
                            <span>Obtener Pregunta</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bot√≥n flotante para nueva pregunta -->
    <button class="floating-new-question" id="floatingNewQuestionBtn" title="Nueva Pregunta">
        <i class="fas fa-plus"></i>
    </button>
    
    <!-- MODAL DE PREGUNTA (Modo Estudio) -->
    <div class="modal-overlay" id="studyQuestionModal" style="display:none;">
      <div class="modal study-modal">
        <div class="modal-header">
          <div class="question-badges">
            <span class="badge badge-subject" id="modalQuestionSubject"></span>
            <span class="badge badge-topic" id="modalQuestionTopic"></span>
            <span class="badge badge-university" id="modalQuestionUniversity"></span>
          </div>
          <button class="modal-close" onclick="closeStudyModal()">&times;</button>
        </div>
    
        <div class="modal-body">
          <div class="question-content" id="modalQuestionText"></div>
    
          <!-- Opciones -->
          <div id="modalOptionsContainer"></div>
    
          <!-- Respuesta -->
          <div class="answer-section" id="modalAnswerSection" style="display:none;">
            <div id="modalAnswerText"></div>
            <div id="modalSolutionText" style="margin-top:10px;"></div>
          </div>
        </div>
    
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="showModalAnswer()">
            <i class="fas fa-eye"></i> Ver respuesta
          </button>
          <button class="btn btn-primary" onclick="getRandomQuestion()">
            <i class="fas fa-dice"></i> Nueva pregunta
          </button>
        </div>
      </div>
    </div>


        <!-- Modal de Carga Masiva (VERSI√ìN MEJORADA) -->
       <!-- Modal de Carga Masiva (VERSI√ìN SIMPLIFICADA) -->
    <div class="modal-overlay" id="bulkModal" style="display: none;">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-file-import"></i> Carga Masiva de Preguntas
                </h3>
                <button class="modal-close" onclick="closeBulkModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <!-- Selectores de materia y tema -->
                <div class="form-row" style="display: flex; gap: 15px; margin-bottom: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label><i class="fas fa-book"></i> Materia</label>
                        <select class="form-control" id="bulkSubject">
                            <option value="Matem√°ticas">Matem√°ticas</option>
                            <option value="F√≠sica">F√≠sica</option>
                            <option value="Qu√≠mica">Qu√≠mica</option>
                            <option value="Biolog√≠a">Biolog√≠a</option>
                            <option value="Historia">Historia</option>
                            <option value="Geograf√≠a">Geograf√≠a</option>
                            <option value="Literatura">Literatura</option>
                            <option value="Ingl√©s">Ingl√©s</option>
                            <option value="_new_">‚úèÔ∏è Otra materia...</option>
                        </select>
                        
                        <input type="text" class="form-control" id="bulkNewSubject" 
                               placeholder="Escribe la nueva materia" style="margin-top: 8px; display: none;">
                    </div>
                    
                    <div class="form-group" style="flex: 1;">
                        <label><i class="fas fa-tag"></i> Tema</label>
                        <input type="text" class="form-control" id="bulkTopic" 
                               placeholder="Ej: √Ålgebra, C√°lculo, Geometr√≠a">
                    </div>
                    
                    <div class="form-group" style="flex: 1;">
                        <label><i class="fas fa-university"></i> Universidad</label>
                        <select class="form-control" id="bulkUniversity">
                            <option value="UNAM">UNAM</option>
                            <option value="IPN">IPN</option>
                            <option value="UAM">UAM</option>
                            <option value="TEC">TEC</option>
                            <option value="EXANI">EXANI</option>
                            <option value="NAVAL">NAVAL</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group" style="margin-bottom: 15px;">
                    <label><i class="fas fa-clipboard-check"></i> Simulador (opcional)</label>
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <label style="display: flex; align-items: center; gap: 8px; font-weight: 600;">
                            <input type="checkbox" id="bulkIsSimulator">
                            Guardar en simulador
                        </label>
                        <input type="text" class="form-control" id="bulkSimulatorName"
                               placeholder="Nombre del simulador" style="flex: 1; min-width: 220px; display: none;">
                    </div>
                    <div class="form-hint" id="bulkSimulatorHint" style="display: none;">
                        <i class="fas fa-info-circle"></i> Se guardar√° con materia "Simulador" y tema con este nombre.
                    </div>
                </div>

                <!-- √Årea de texto principal -->
                <div class="form-group">
                    <label><i class="fas fa-paste"></i> Pega las preguntas aqu√≠</label>
                    <textarea 
                        id="bulkText" 
                        rows="15" 
                        placeholder="Pega aqu√≠ las preguntas en formato:
Pregunta 1
A) Opci√≥n A
B) Opci√≥n B
C) Opci√≥n C
D) Opci√≥n D
Respuesta: A

Pregunta 2
A) Opci√≥n A
B) Opci√≥n B
C) Opci√≥n C
D) Opci√≥n D
Respuesta: B"
                        style="width: 100%; font-family: 'Courier New', monospace; font-size: 0.9rem; padding: 12px;"
                    ></textarea>
                    
                    <div class="text-info" style="margin-top: 8px; font-size: 0.85rem; display: flex; justify-content: space-between;">
                        <div>
                            <i class="fas fa-chart-bar"></i> 
                            <span id="bulkStats">0 preguntas detectadas | 0 l√≠neas</span>
                        </div>
                        <button class="btn btn-outline btn-sm" onclick="ejemploFormato()" style="font-size: 0.8rem;">
                            <i class="fas fa-question-circle"></i> Ver ejemplo
                        </button>
                    </div>
                </div>
                
                <!-- Vista previa (MEJORADA) -->
                <div class="preview-container" id="bulkPreview" style="display: none; margin-top: 20px;">
                    <h5 style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-search"></i> Vista previa (primera pregunta)
                    </h5>
                    <div id="bulkPreviewContent" style="
                        background: #f8f9fa; 
                        padding: 15px; 
                        border-radius: 8px; 
                        border: 1px solid #dee2e6;
                        font-family: 'Courier New', monospace;
                        font-size: 0.9rem;
                        white-space: pre-wrap;
                        max-height: 200px;
                        overflow-y: auto;
                        color: #212529;
                        line-height: 1.6;
                    ">
                    </div>
                    <div style="margin-top: 8px; font-size: 0.8rem; color: #6c757d;">
                        <i class="fas fa-info-circle"></i> Se procesar√° en el lote completo
                    </div>
                </div>
                
                <!-- Barra de progreso -->
                <div class="progress-container" id="bulkProgressContainer" style="display: none; margin-top: 20px;">
                    <div class="progress-bar" id="bulkProgressBar"></div>
                    <div class="progress-text" id="bulkProgressText">0%</div>
                </div>
                
                <!-- Resultados -->
                <div class="result-container" id="bulkResultContainer" style="display: none; margin-top: 20px;">
                    <div id="bulkResultMessage"></div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBulkModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn btn-primary" onclick="procesarCargaMasiva()" id="processBulkBtn">
                    <i class="fas fa-play"></i> Procesar Preguntas
                </button>
            </div>
        </div>



</div>
   
<!-- Modal para agregar/editar preguntas (MODAL MEJORADO) -->
<div class="modal-overlay" id="questionModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">
                <i class="fas fa-plus-circle"></i> Nueva Pregunta
            </h3>
            <button class="modal-close" id="closeModalBtn">&times;</button>
        </div>
        
        <div class="modal-body">
            <div class="form-group modal-subject-group">
                <label><i class="fas fa-book"></i> Materia</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select class="form-control" id="modalSubject" style="flex: 1;">
                        <option value="Matem√°ticas">Matem√°ticas</option>
                        <option value="F√≠sica">F√≠sica</option>
                        <option value="Qu√≠mica">Qu√≠mica</option>
                        <option value="Biolog√≠a">Biolog√≠a</option>
                        <option value="Historia">Historia</option>
                        <option value="Geograf√≠a">Geograf√≠a</option>
                        <option value="Simulador">Simulador</option>
                    </select>
                    <input type="text" class="form-control" id="modalNewSubject" 
                           placeholder="Otra materia" style="flex: 1; display: none;">
                </div>
                <div class="form-hint">
                    <i class="fas fa-info-circle"></i> Selecciona una materia existente o escribe una nueva
                </div>
            </div>

            <div class="form-group">
                <label><i class="fas fa-clipboard-check"></i> Simulador (opcional)</label>
                <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 8px; font-weight: 600;">
                        <input type="checkbox" id="modalIsSimulator">
                        Guardar en simulador
                    </label>
                    <input type="text" class="form-control" id="modalSimulatorName"
                           placeholder="Nombre del simulador" style="flex: 1; min-width: 220px; display: none;">
                </div>
                <div class="form-hint" id="simulatorHint" style="display: none;">
                    <i class="fas fa-info-circle"></i> Se guardar√É¬° con materia "Simulador" y tema con este nombre.
                </div>
            </div>
                            
            <div class="form-group">
                <label><i class="fas fa-tag"></i> Tema</label>
                <input type="text" class="form-control" id="modalTopic" 
                       placeholder="Ej: √Ålgebra, C√°lculo, Geometr√≠a">
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-question-circle"></i> Pregunta</label>
                
                <!-- TECLADO MATEM√ÅTICO COMPLETO PARA PREGUNTA -->
                <div class="math-toolbar" id="questionMathToolbar">
                    <div class="toolbar-section">
                        <span class="section-label">Operaciones:</span>
                        <button type="button" class="math-btn" data-symbol="\frac{ }{ }" title="Fracci√≥n" data-target="modalQuestion">
                            <i class="fas fa-divide"></i> Fracci√≥n
                        </button>
                        <button type="button" class="math-btn" data-symbol="\sqrt{ }" title="Ra√≠z cuadrada" data-target="modalQuestion">‚àö</button>
                        <button type="button" class="math-btn" data-symbol="\sqrt[n]{ }" title="Ra√≠z n-√©sima" data-target="modalQuestion">‚Åø‚àö</button>
                        <button type="button" class="math-btn" data-symbol="^{ }" title="Exponente" data-target="modalQuestion">x¬≤</button>
                        <button type="button" class="math-btn" data-symbol="_{ }" title="Sub√≠ndice" data-target="modalQuestion"> x‚ÇÇ </button>
                    </div>
                    
                    <div class="toolbar-section">
                        <span class="section-label">Trig:</span>
                        <button type="button" class="math-btn" data-symbol="\sin(" title="Seno" data-target="modalQuestion">sin</button>
                        <button type="button" class="math-btn" data-symbol="\cos(" title="Coseno" data-target="modalQuestion">cos</button>
                        <button type="button" class="math-btn" data-symbol="\tan(" title="Tangente" data-target="modalQuestion">tan</button>
                    </div>
                    
                    <div class="toolbar-section">
                        <span class="section-label">C√°lculo:</span>
                        <button type="button" class="math-btn" data-symbol="\lim_{ \to }" title="L√≠mite" data-target="modalQuestion">lim</button>
                        <button type="button" class="math-btn" data-symbol="\int_{ }^{ }" title="Integral" data-target="modalQuestion">‚à´</button>
                        <button type="button" class="math-btn" data-symbol="\sum_{ }^{ }" title="Sumatoria" data-target="modalQuestion">‚àë</button>
                    </div>
                    
                    <div class="toolbar-section">
                        <span class="section-label">S√≠mbolos:</span>
                        <button type="button" class="math-btn" data-symbol="\infty" title="Infinito" data-target="modalQuestion">‚àû</button>
                        <button type="button" class="math-btn" data-symbol="\pi" title="Pi" data-target="modalQuestion">œÄ</button>
                        <button type="button" class="math-btn" data-symbol="\theta" title="Theta" data-target="modalQuestion">Œ∏</button>
                        <button type="button" class="math-btn" data-symbol="\alpha" title="Alpha" data-target="modalQuestion">Œ±</button>
                        <button type="button" class="math-btn" data-symbol="\beta" title="Beta" data-target="modalQuestion">Œ≤</button>
                        <button type="button" class="math-btn" data-symbol="\pm" title="M√°s menos" data-target="modalQuestion">¬±</button>
                    </div>
                    
                    <div class="toolbar-section">
                        <span class="section-label">Estructuras:</span>
                        <button type="button" class="math-btn" data-symbol="( )" title="Par√©ntesis" data-target="modalQuestion">( )</button>
                        <button type="button" class="math-btn" data-symbol="[ ]" title="Corchetes" data-target="modalQuestion">[ ]</button>
                        <button type="button" class="math-btn" data-symbol="\{ \}" title="Llaves" data-target="modalQuestion">{ }</button>
                    </div>
                </div>
                
                <textarea class="form-control" id="modalQuestion" 
                          placeholder="Escribe tu pregunta... (usa los botones arriba para s√≠mbolos)" 
                          rows="4"></textarea>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label><i class="fas fa-image"></i> Imagen (opcional)</label>
                    <input type="file" class="form-control" id="modalImage" accept="image/*">
                    <div class="form-hint">
                        <i class="fas fa-info-circle"></i> Puedes subir una imagen escaneada o foto del ejercicio
                    </div>
                </div>
                
                <div id="imagePreviewContainer" style="margin-top: 10px; display: none;">
                    <div id="imagePreview" style="max-width: 200px; max-height: 200px; border: 1px solid #ddd; border-radius: 5px; overflow: hidden;">
                        <img id="previewImage" src="" alt="Vista previa" style="width: 100%; height: auto;">
                    </div>
                    <div style="margin-top: 5px;">
                        <button type="button" class="btn btn-outline btn-sm" onclick="removeImage()">
                            <i class="fas fa-trash"></i> Quitar imagen
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-check-circle"></i> Respuesta</label>
                
                <!-- TECLADO MATEM√ÅTICO COMPLETO PARA RESPUESTA -->
                <div class="math-toolbar" id="answerMathToolbar">
                    <div class="toolbar-section">
                        <span class="section-label">Operaciones:</span>
                        <button type="button" class="math-btn" data-symbol="\frac{ }{ }" title="Fracci√≥n" data-target="modalAnswer">
                            <i class="fas fa-divide"></i> Fracci√≥n
                        </button>
                        <button type="button" class="math-btn" data-symbol="\sqrt{ }" title="Ra√≠z cuadrada" data-target="modalAnswer">‚àö</button>
                        <button type="button" class="math-btn" data-symbol="\sqrt[n]{ }" title="Ra√≠z n-√©sima" data-target="modalAnswer">‚Åø‚àö</button>
                        <button type="button" class="math-btn" data-symbol="^{ }" title="Exponente" data-target="modalAnswer">x¬≤</button>
                        <button type="button" class="math-btn" data-symbol="=" title="Igual" data-target="modalAnswer">=</button>
                        <button type="button" class="math-btn" data-symbol="_{ }" title="Sub√≠ndice" data-target="modalQuestion"> x‚ÇÇ </button>
                    </div>
                    
                    <div class="toolbar-section">
                        <span class="section-label">S√≠mbolos:</span>
                        <button type="button" class="math-btn" data-symbol="\pi" title="Pi" data-target="modalAnswer">œÄ</button>
                        <button type="button" class="math-btn" data-symbol="\infty" title="Infinito" data-target="modalAnswer">‚àû</button>
                        <button type="button" class="math-btn" data-symbol="\pm" title="M√°s menos" data-target="modalAnswer">¬±</button>
                        <button type="button" class="math-btn" data-symbol="\neq" title="Diferente" data-target="modalAnswer">‚â†</button>
                        <button type="button" class="math-btn" data-symbol="\leq" title="Menor o igual" data-target="modalAnswer">‚â§</button>
                        <button type="button" class="math-btn" data-symbol="\geq" title="Mayor o igual" data-target="modalAnswer">‚â•</button>
                    </div>
                    
                    <div class="toolbar-section">
                        <span class="section-label">Estructuras:</span>
                        <button type="button" class="math-btn" data-symbol="( )" title="Par√©ntesis" data-target="modalAnswer">( )</button>
                        <button type="button" class="math-btn" data-symbol="[ ]" title="Corchetes" data-target="modalAnswer">[ ]</button>
                        <button type="button" class="math-btn" data-symbol="\{ \}" title="Llaves" data-target="modalAnswer">{ }</button>
                    </div>
                </div>
                
                <!-- Checkbox para opciones m√∫ltiples -->
                <div style="margin: 12px 0 8px 0;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.85rem;">
                        <input type="checkbox" id="hasOptionsCheckbox" onchange="toggleOptions()">
                        <span><i class="fas fa-list-ol"></i> Es una pregunta de opci√≥n m√∫ltiple (4 opciones)</span>
                    </label>
                </div>
                
                <!-- RESPUESTA ABIERTA (por defecto) -->
                <div id="openAnswerSection">
                    <textarea class="form-control" id="modalAnswer" 
                              placeholder="Escribe la respuesta... (usa los botones arriba para s√≠mbolos)" 
                              rows="3"></textarea>
                </div>
                
                <!-- SECCI√ìN DE OPCIONES (oculta por defecto) -->
                <div id="optionsSection" style="display: none;">
                    <h4><i class="fas fa-check-circle"></i> Opciones de Respuesta (selecciona la correcta)</h4>
                    
                    <div class="options-grid">
                        <!-- Opci√≥n A -->
                        <div class="option-group">
                            <label style="color: #ef4444;"><i class="fas fa-circle"></i> Opci√≥n A</label>
                            <textarea class="form-control option-input" id="optionA" 
                                      placeholder="Texto de la opci√≥n A" rows="2"
                                      onfocus="handleOptionFocus(event)"></textarea>
                            <div style="margin-top: 6px;">
                                <label style="display: inline-flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.8rem;">
                                    <input type="radio" name="correctOption" value="0" id="correctOptionA">
                                    <span>Es la correcta</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Opci√≥n B -->
                        <div class="option-group">
                            <label style="color: #3b82f6;"><i class="fas fa-circle"></i> Opci√≥n B</label>
                            <textarea class="form-control option-input" id="optionB" 
                                        placeholder="Texto de la opci√≥n B" rows="2"
                                        onfocus="handleOptionFocus(event)"></textarea>
                            <div style="margin-top: 6px;">
                                <label style="display: inline-flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.8rem;">
                                    <input type="radio" name="correctOption" value="1" id="correctOptionB">
                                    <span>Es la correcta</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Opci√≥n C -->
                        <div class="option-group">
                            <label style="color: #22c55e;"><i class="fas fa-circle"></i> Opci√≥n C</label>
                            <textarea class="form-control option-input" id="optionC" 
                                      placeholder="Texto de la opci√≥n C" rows="2"
                                       onfocus="handleOptionFocus(event)"></textarea>
                            <div style="margin-top: 6px;">
                                <label style="display: inline-flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.8rem;">
                                    <input type="radio" name="correctOption" value="2" id="correctOptionC">
                                    <span>Es la correcta</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Opci√≥n D -->
                        <div class="option-group">
                            <label style="color: #f59e0b;"><i class="fas fa-circle"></i> Opci√≥n D</label>
                            <textarea class="form-control option-input" id="optionD" 
                                      placeholder="Texto de la opci√≥n D" rows="2"
                                       onfocus="handleOptionFocus(event)"></textarea>
                            <div style="margin-top: 6px;">
                                <label style="display: inline-flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.8rem;">
                                    <input type="radio" name="correctOption" value="3" id="correctOptionD">
                                    <span>Es la correcta</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-hint" style="margin-top: 12px;">
                        <i class="fas fa-info-circle"></i> Marca con el bot√≥n de radio cu√°l es la opci√≥n correcta
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-list-ol"></i> Soluci√≥n Detallada (Opcional)</label>
                
                <!-- TECLADO MATEM√ÅTICO COMPLETO PARA SOLUCI√ìN -->
                <div class="math-toolbar" id="solutionMathToolbar">
                    <div class="toolbar-section">
                        <span class="section-label">Operaciones:</span>
                        <button type="button" class="math-btn" data-symbol="\frac{ }{ }" title="Fracci√≥n" data-target="modalSolution">
                            <i class="fas fa-divide"></i> Fracci√≥n
                        </button>
                        <button type="button" class="math-btn" data-symbol="\sqrt{ }" title="Ra√≠z cuadrada" data-target="modalSolution">‚àö</button>
                        <button type="button" class="math-btn" data-symbol="\sqrt[n]{ }" title="Ra√≠z n-√©sima" data-target="modalSolution">‚Åø‚àö</button>
                        <button type="button" class="math-btn" data-symbol="^{ }" title="Exponente" data-target="modalSolution">x¬≤</button>
                        <button type="button" class="math-btn" data-symbol="=" title="Igual" data-target="modalSolution">=</button>
                        <button type="button" class="math-btn" data-symbol="\Rightarrow" title="Implica" data-target="modalSolution">‚áí</button>
                    </div>
                    
                    <div class="toolbar-section">
                        <span class="section-label">C√°lculo:</span>
                        <button type="button" class="math-btn" data-symbol="\int_{ }^{ }" title="Integral" data-target="modalSolution">‚à´</button>
                        <button type="button" class="math-btn" data-symbol="\frac{d}{dx}" title="Derivada" data-target="modalSolution">d/dx</button>
                        <button type="button" class="math-btn" data-symbol="\lim_{ \to }" title="L√≠mite" data-target="modalSolution">lim</button>
                        <button type="button" class="math-btn" data-symbol="\sum_{ }^{ }" title="Sumatoria" data-target="modalSolution">‚àë</button>
                    </div>
                    
                    <div class="toolbar-section">
                        <span class="section-label">S√≠mbolos:</span>
                        <button type="button" class="math-btn" data-symbol="\pi" title="Pi" data-target="modalSolution">œÄ</button>
                        <button type="button" class="math-btn" data-symbol="\theta" title="Theta" data-target="modalSolution">Œ∏</button>
                        <button type="button" class="math-btn" data-symbol="\alpha" title="Alpha" data-target="modalSolution">Œ±</button>
                        <button type="button" class="math-btn" data-symbol="\beta" title="Beta" data-target="modalSolution">Œ≤</button>
                        <button type="button" class="math-btn" data-symbol="\pm" title="M√°s menos" data-target="modalSolution">¬±</button>
                    </div>
                </div>
                
                <textarea class="form-control" id="modalSolution" 
                          placeholder="Explica los pasos para llegar a la respuesta..." 
                          rows="4"></textarea>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-university"></i> Universidad</label>
                <select class="form-control" id="modalUniversity">
                    <option value="UNAM">UNAM</option>
                    <option value="IPN">IPN</option>
                    <option value="UAM">UAM</option>
                    <option value="TEC">TEC</option>
                    <option value="EXANI">EXANI</option>
                    <option value="NAVAL">NAVAL</option>
                    <option value="_new_">‚úèÔ∏è Otra universidad...</option>
                </select>
            
                <input
                    type="text"
                    class="form-control"
                    id="modalNewUniversity"
                    placeholder="Escribe la universidad"
                    style="margin-top: 8px; display: none;"
                />
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelModalBtn">Cancelar</button>
            <button class="btn btn-primary" id="saveQuestionBtn">
                <i class="fas fa-save"></i> Guardar Pregunta
            </button>
        </div>
    </div>
</div>
              
        <!-- Modal para imagen ampliada -->
    <div class="image-modal" id="imageModal" onclick="closeImageModal()">
        <span class="close">&times;</span>
        <img id="modalExpandedImage" >
    </div>
    
    <!-- Modal de confirmaci√≥n para eliminar -->
    <div class="modal-overlay" id="confirmModal" style="display: none;">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-exclamation-triangle"></i> Confirmar Eliminaci√≥n
                </h3>
                <button class="modal-close" onclick="closeConfirmModal()">&times;</button>
            </div>
            
            <div class="modal-body">
                <p id="confirmMessage">¬øEst√°s seguro de que quieres eliminar esta pregunta?</p>
                <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 10px;">
                    Esta acci√≥n no se puede deshacer.
                </p>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">Cancelar</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de ayuda -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-question-circle"></i> Ayuda para Maestros</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <h4 style="margin-bottom: 12px; color: var(--text-primary);">üìö Panel de Maestro</h4>
                <ul style="margin: 0 0 20px 20px; line-height: 1.7; color: var(--text-secondary); font-size: 0.9rem;">
                    <li><strong>Banco de Preguntas:</strong> Ver, editar y eliminar todas las preguntas del sistema</li>
                    <li><strong>Estad√≠sticas:</strong> Ver an√°lisis detallados del uso del sistema</li>
                    <li><strong>Modo Estudio:</strong> Probar las preguntas como lo har√≠a un alumno</li>
                    <li><strong>Nueva Pregunta:</strong> Agregar preguntas nuevas con f√≥rmulas matem√°ticas</li>
                </ul>
                
                <h4 style="margin-bottom: 12px; color: var(--text-primary);">üìù Crear Preguntas</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">
                    Puedes crear dos tipos de preguntas:
                </p>
                <ul style="margin: 8px 0 20px 20px; color: var(--text-secondary); font-size: 0.9rem;">
                    <li><strong>Respuesta abierta:</strong> El alumno debe pensar la respuesta</li>
                    <li><strong>Opci√≥n m√∫ltiple:</strong> Con 4 opciones, solo una correcta</li>
                </ul>
                
                <h4 style="margin-bottom: 12px; color: var(--text-primary);">üìä Estad√≠sticas</h4>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">
                    Como maestro puedes ver:
                </p>
                <ul style="margin: 8px 0 0 20px; color: var(--text-secondary); font-size: 0.9rem;">
                    <li>Distribuci√≥n de preguntas por materia y universidad</li>
                    <li>Temas m√°s populares entre los alumnos</li>
                    <li>Rendimiento general del sistema</li>
                    <li>Preguntas m√°s visitadas</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary">Entendido</button>
            </div>
        </div>
    </div>
    
    <!-- Notificaci√≥n -->
    <div class="notification" id="notification"></div>
    
    
    <!-- JavaScript para el panel de maestro -->
    <script src="{{ url_for('static', filename='js/maestro.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

</body>
</html>
